<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 页面生成器</title>
    <!-- 引入Element UI样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <style>
        :root {
            --morandi-green: #8BA888;
            --morandi-green-light: #A5B5A3;
            --morandi-green-dark: #6B8A6B;
            --step-1-color: #A5B5A3;
            --step-2-color: #8BA888;
            --step-3-color: #7B9A78;
            --step-4-color: #6B8A6B;
        }
        
        body {
            margin: 0;
            padding: 0;
            font-family: "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
        }
        
        .el-container {
            height: 100vh;
            overflow: hidden;
        }
        
        .el-header {
            background-color: var(--morandi-green);
            color: white;
            line-height: 60px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            height: 60px !important;
        }
        
        .el-main {
            padding: 20px;
            background-color: #f5f7fa;
            height: calc(100vh - 60px);
            display: flex;
            flex-direction: column;
            align-items: stretch;
            overflow: hidden;
        }
        
        .generation-process {
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 20px;
            margin: 0;
            background-color: white;
            border-radius: 0;
            box-shadow: none;
            height: 0;
            opacity: 0;
            overflow: hidden;
            transition: all 0.5s ease-in-out;
            position: relative;
            z-index: 1;
            transform: translateY(-20px);
        }
        
        .generation-process.show {
            height: 100px;
            opacity: 1;
            transform: translateY(0);
        }
        
        .ai-container {
            width: 100%;
            height: 700px;
            background-color: #f5f7fa;
            display: flex;
            flex-direction: column;
            margin: 0;
            box-shadow: none;
            border-radius: 0;
            position: relative;
            overflow: hidden;
        }
        
        .ai-header {
            padding: 20px;
            border-bottom: 1px solid #ebeef5;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .ai-title {
            font-size: 18px;
            font-weight: bold;
        }
        
        .process-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            flex: 1;
            background: transparent;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease-in-out;
        }
        
        .generation-process.show .process-step {
            opacity: 1;
            transform: translateY(0);
        }
        
        .generation-process.show .process-step:nth-child(1) { transition-delay: 0.1s; }
        .generation-process.show .process-step:nth-child(2) { transition-delay: 0.2s; }
        .generation-process.show .process-step:nth-child(3) { transition-delay: 0.3s; }
        .generation-process.show .process-step:nth-child(4) { transition-delay: 0.4s; }
        
        .process-step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 20px;
            right: -50%;
            width: 100%;
            height: 2px;
            background-color: #dcdfe6;
            z-index: 1;
        }
        
        .process-step.active:not(:last-child)::after {
            background-color: var(--morandi-green);
        }
        
        .step-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #f5f7fa;
            border: 2px solid #dcdfe6;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            position: relative;
            z-index: 2;
        }
        
        .process-step.active .step-icon {
            border-color: var(--morandi-green);
            color: white;
        }
        
        .process-step.active[class*="active"]:nth-child(1) .step-icon {
            background-color: var(--step-1-color);
            border-color: var(--step-1-color);
        }
        
        .process-step.active[class*="active"]:nth-child(2) .step-icon {
            background-color: var(--step-2-color);
            border-color: var(--step-2-color);
        }
        
        .process-step.active[class*="active"]:nth-child(3) .step-icon {
            background-color: var(--step-3-color);
            border-color: var(--step-3-color);
        }
        
        .process-step.active[class*="active"]:nth-child(4) .step-icon {
            background-color: var(--step-4-color);
            border-color: var(--step-4-color);
        }
        
        .process-step.active[class*="active"]:nth-child(1):not(:last-child)::after {
            background-color: var(--step-1-color);
        }
        
        .process-step.active[class*="active"]:nth-child(2):not(:last-child)::after {
            background-color: var(--step-2-color);
        }
        
        .process-step.active[class*="active"]:nth-child(3):not(:last-child)::after {
            background-color: var(--step-3-color);
        }
        
        .process-step.active[class*="active"]:nth-child(4):not(:last-child)::after {
            background-color: var(--step-4-color);
        }
        
        .step-text {
            font-size: 14px;
            color: #909399;
        }
        
        .process-step.active .step-text {
            color: var(--morandi-green);
        }
        
        .process-step.active[class*="active"]:nth-child(1) .step-text {
            color: var(--step-1-color);
        }
        
        .process-step.active[class*="active"]:nth-child(2) .step-text {
            color: var(--step-2-color);
        }
        
        .process-step.active[class*="active"]:nth-child(3) .step-text {
            color: var(--step-3-color);
        }
        
        .process-step.active[class*="active"]:nth-child(4) .step-text {
            color: var(--step-4-color);
        }
        
        .ai-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            background-color: #f5f7fa;
            border-radius: 0;
            transition: margin-top 0.3s ease-in-out;
            position: relative;
            z-index: 0;
        }
        
        .ai-content.no-margin {
            margin-top: 0;
        }
        
        .ai-message {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 8px;
            background-color: white;
            max-width: 80%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .ai-message.welcome {
            margin-bottom: 20px;
            background-color: var(--morandi-green-light);
            color: white;
            max-width: 100%;
            box-shadow: none;
        }
        
        .ai-message.user {
            margin-left: auto;
            background-color: var(--morandi-green-light);
            color: white;
            box-shadow: none;
        }
        
        .ai-input {
            padding: 20px;
            border-top: 1px solid #ebeef5;
            display: flex;
            gap: 10px;
            background-color: white;
            position: relative;
            z-index: 2;
        }
        
        .ai-input .el-input {
            flex: 1;
        }
        
        .ai-input .el-button {
            min-width: 80px;
        }
        
        .el-button {
            border-radius: 20px;
        }
        
        .generation-result {
            padding: 20px;
            text-align: center;
            opacity: 0;
            height: 0;
            overflow: hidden;
            transition: all 0.3s ease-in-out;
        }
        
        .generation-result.show {
            opacity: 1;
            height: auto;
        }
        
        .page-name {
            font-size: 24px;
            font-weight: bold;
            color: var(--morandi-green);
            margin-bottom: 20px;
        }
        
        .edit-button {
            margin-top: 10px;
        }
        
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease-in-out;
        }
        
        .modal-backdrop.show {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 8px;
            padding: 30px;
            width: 400px;
            text-align: center;
            transform: scale(0.8);
            transition: all 0.3s ease-in-out;
        }
        
        .modal-backdrop.show .modal-content {
            transform: scale(1);
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--morandi-green);
            margin-bottom: 20px;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }
        
        .page-list {
            width: 100%;
            max-width: none;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 12px 0 rgba(0,0,0,0.1);
            padding: 20px;
            opacity: 1;
            height: auto;
            overflow: visible;
            transition: all 0.3s ease-in-out;
            display: flex;
            flex-direction: column;
            flex: 1;
        }
        
        .page-list.show {
            opacity: 1;
            height: calc(100vh - 100px);
        }
        
        .tab-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .tab-header {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 5%;
        }
        
        .tab-header .el-button {
            min-width: 120px;
        }
        
        .el-tabs {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .el-tabs__content {
            flex: 1;
            overflow: hidden;
            padding: 0;
        }
        
        .el-tab-pane {
            height: 100%;
            overflow: hidden;
            padding: 0;
        }
        
        /* 添加对话框遮罩层样式 */
        .el-dialog__wrapper {
            background-color: rgba(0, 0, 0, 0.5) !important;
            backdrop-filter: blur(5px);
        }
        
        /* 确保遮罩层样式不被覆盖 */
        .v-modal {
            background-color: transparent !important;
            opacity: 1 !important;
        }
        
        /* 统一所有对话框的样式 */
        .ai-dialog, .workflow-dialog {
            .el-dialog {
                width: 90% !important;
                max-width: 1400px;
                margin: 5vh auto !important;
                background: rgba(245, 247, 250, 0.95);
                border-radius: 8px;
                overflow: hidden;
                backdrop-filter: blur(10px);
                box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            }
            
            .el-dialog__body {
                padding: 0 !important;
                min-height: 700px;
                background: rgba(245, 247, 250, 0.95);
                backdrop-filter: blur(10px);
            }
            
            .el-dialog__header {
                padding: 20px;
                background: rgba(255, 255, 255, 0.95);
                margin: 0;
                position: relative;
                z-index: 2;
                border-bottom: 1px solid rgba(235, 238, 245, 0.8);
                backdrop-filter: blur(10px);
            }
        }
        
        .el-table {
            background: transparent;
        }
        
        .el-table::before {
            display: none;
        }
        
        .el-table th {
            background-color: #f5f7fa;
            color: #606266;
            font-weight: 500;
            border-bottom: 1px solid #EBEEF5;
        }
        
        .el-table td {
            padding: 12px 0;
        }
        
        .el-table--border, .el-table--group {
            border: none;
        }
        
        .el-table--border::after, .el-table--group::after {
            display: none;
        }
        
        .el-table--border td, .el-table--border th {
            border-right: none;
        }
        
        .el-table--border td:first-child, .el-table--border th:first-child {
            border-left: none;
        }
        
        .el-table--striped .el-table__body tr.el-table__row--striped td {
            background: #fafafa;
        }
        
        .el-table__body tr:hover > td {
            background-color: #f5f7fa !important;
        }
        
        .el-button--mini {
            padding: 7px 12px;
        }
        
        .el-tag--small {
            height: 22px;
            padding: 0 8px;
            line-height: 20px;
        }
        
        .el-table .cell {
            padding: 0 12px;
        }
        
        .el-dialog__headerbtn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 0;
            background: transparent;
            border: none;
            outline: none;
            cursor: pointer;
            font-size: 16px;
        }
        
        .el-dialog__title {
            line-height: 24px;
            font-size: 18px;
            color: #303133;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div id="app">
        <el-container>
            <el-header>
                <div style="display: flex; justify-content: space-between; width: 100%;">
                    <el-button @click="goBack">返回</el-button>
                    <div></div>
                </div>
            </el-header>
            
            <el-main>
                <div class="page-list" :class="{ 'show': !showProcess && !showResult }">
                    <el-tabs v-model="activeTab" type="card" class="tab-content">
                        <el-tab-pane label="页面列表" name="pages">
                            <div class="tab-header">
                                <el-button type="primary" icon="el-icon-plus" @click="showAiDialog = true">新增页面</el-button>
                            </div>
                            <el-table :data="pageList" 
                                     style="width: 100%;" 
                                     border
                                     row-key="name"
                                     :tree-props="{children: 'children', hasChildren: 'hasChildren'}"
                                     height="calc(100vh - 280px)">  <!-- 调整表格高度，为分页留出空间 -->
                                <el-table-column prop="name" label="页面名称">
                                    <template slot-scope="scope">
                                        <span :style="{ paddingLeft: (scope.row.level - 1) * 20 + 'px' }">
                                            {{ scope.row.name }}
                                        </span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="type" label="页面类型"></el-table-column>
                                <el-table-column prop="createTime" label="创建时间" width="180"></el-table-column>
                                <el-table-column prop="status" label="状态" width="100">
                                    <template slot-scope="scope">
                                        <el-tag :type="scope.row.status === '已发布' ? 'success' : 'warning'">
                                            {{ scope.row.status }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="操作" width="250">
                                    <template slot-scope="scope">
                                        <el-button size="mini" @click="handlePreview(scope.row)">预览</el-button>
                                        <el-button size="mini" type="primary" @click="goToEditor">编辑</el-button>
                                        <el-button 
                                            size="mini" 
                                            :type="scope.row.status === '已发布' ? 'info' : 'success'"
                                            @click="handlePublish(scope.row)">
                                            {{ scope.row.status === '已发布' ? '下线' : '发布' }}
                                        </el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                            <div style="margin-top: 20px; text-align: right;">
                                <el-pagination
                                    @size-change="handlePageSizeChange"
                                    @current-change="handlePageChange"
                                    :current-page="pageConfig.pages.currentPage"
                                    :page-sizes="[10, 20, 30, 50]"
                                    :page-size="pageConfig.pages.pageSize"
                                    layout="total, sizes, prev, pager, next, jumper"
                                    :total="pageConfig.pages.total">
                                </el-pagination>
                            </div>
                        </el-tab-pane>
                        
                        <el-tab-pane label="审批流程" name="workflows">
                            <div class="tab-header">
                                <el-button type="primary" icon="el-icon-plus" @click="showWorkflowAiDialog = true">新增审批流程</el-button>
                            </div>
                            <el-table :data="workflowList" 
                                     style="width: 100%;" 
                                     border
                                     row-key="name"
                                     :tree-props="{children: 'children', hasChildren: 'hasChildren'}"
                                     height="calc(100vh - 280px)">  <!-- 调整表格高度，为分页留出空间 -->
                                <el-table-column prop="name" label="流程名称">
                                    <template slot-scope="scope">
                                        <span :style="{ paddingLeft: (scope.row.level - 1) * 20 + 'px' }">
                                            <i :class="scope.row.icon" style="margin-right: 5px"></i>
                                            {{ scope.row.name }}
                                        </span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="type" label="流程类型" width="120">
                                    <template slot-scope="scope">
                                        <el-tag :type="scope.row.type === '审批流程' ? 'danger' : 'primary'" size="small">
                                            {{ scope.row.type }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="department" label="所属部门"></el-table-column>
                                <el-table-column prop="createTime" label="创建时间" width="180"></el-table-column>
                                <el-table-column prop="status" label="状态" width="100">
                                    <template slot-scope="scope">
                                        <el-tag :type="scope.row.status === '已启用' ? 'success' : 'info'">
                                            {{ scope.row.status }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="操作" width="280">
                                    <template slot-scope="scope">
                                        <el-button size="mini" @click="handlePreviewWorkflow(scope.row)">预览</el-button>
                                        <el-button size="mini" type="primary" @click="editWorkflow(scope.row)">编辑</el-button>
                                        <el-button 
                                            size="mini" 
                                            :type="scope.row.status === '已启用' ? 'info' : 'success'"
                                            @click="handleWorkflowStatus(scope.row)">
                                            {{ scope.row.status === '已启用' ? '停用' : '启用' }}
                                        </el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                            <div style="margin-top: 20px; text-align: right;">
                                <el-pagination
                                    @size-change="handleWorkflowPageSizeChange"
                                    @current-change="handleWorkflowPageChange"
                                    :current-page="pageConfig.workflows.currentPage"
                                    :page-sizes="[10, 20, 30, 50]"
                                    :page-size="pageConfig.workflows.pageSize"
                                    layout="total, sizes, prev, pager, next, jumper"
                                    :total="pageConfig.workflows.total">
                                </el-pagination>
                            </div>
                        </el-tab-pane>

                        <el-tab-pane label="数据流程" name="dataflows">
                            <div class="tab-header">
                                <el-button type="primary" icon="el-icon-plus" @click="showDataflowAiDialog = true">新增数据流程</el-button>
                            </div>
                            <el-table :data="dataflowList" 
                                     style="width: 100%;" 
                                     border
                                     row-key="name"
                                     :tree-props="{children: 'children', hasChildren: 'hasChildren'}"
                                     height="calc(100vh - 280px)">  <!-- 调整表格高度，为分页留出空间 -->
                                <el-table-column prop="name" label="流程名称">
                                    <template slot-scope="scope">
                                        <span :style="{ paddingLeft: (scope.row.level - 1) * 20 + 'px' }">
                                            <i :class="scope.row.icon" style="margin-right: 5px"></i>
                                            {{ scope.row.name }}
                                        </span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="type" label="数据类型" width="120">
                                    <template slot-scope="scope">
                                        <el-tag :type="scope.row.type === '同步流程' ? 'warning' : 'success'" size="small">
                                            {{ scope.row.type }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="source" label="数据源"></el-table-column>
                                <el-table-column prop="createTime" label="创建时间" width="180"></el-table-column>
                                <el-table-column prop="status" label="状态" width="100">
                                    <template slot-scope="scope">
                                        <el-tag :type="scope.row.status === '运行中' ? 'success' : 'info'">
                                            {{ scope.row.status }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="操作" width="280">
                                    <template slot-scope="scope">
                                        <el-button size="mini" @click="handlePreviewDataflow(scope.row)">预览</el-button>
                                        <el-button size="mini" type="primary" @click="editDataflow(scope.row)">编辑</el-button>
                                        <el-button 
                                            size="mini" 
                                            :type="scope.row.status === '运行中' ? 'danger' : 'success'"
                                            @click="handleDataflowStatus(scope.row)">
                                            {{ scope.row.status === '运行中' ? '停止' : '启动' }}
                                        </el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                            <div style="margin-top: 20px; text-align: right;">
                                <el-pagination
                                    @size-change="handleDataflowPageSizeChange"
                                    @current-change="handleDataflowPageChange"
                                    :current-page="pageConfig.dataflows.currentPage"
                                    :page-sizes="[10, 20, 30, 50]"
                                    :page-size="pageConfig.dataflows.pageSize"
                                    layout="total, sizes, prev, pager, next, jumper"
                                    :total="pageConfig.dataflows.total">
                                </el-pagination>
                            </div>
                        </el-tab-pane>
                    </el-tabs>
                </div>

                <!-- AI 生成对话框 -->
                <el-dialog
                    title="AI 页面生成器"
                    :visible.sync="showAiDialog"
                    custom-class="ai-dialog"
                    :close-on-click-modal="false"
                    :close-on-press-escape="false"
                    :show-close="!isGenerating"
                    @open="handleDialogOpen">
                    <div class="ai-container">
                        <div class="generation-process" :class="{ 'show': showProcess }">
                            <div class="process-step" :class="{ 'active': currentStep >= 1 }">
                                <div class="step-icon">
                                    <i class="el-icon-document"></i>
                                </div>
                                <div class="step-text">生成页面</div>
                            </div>
                            <div class="process-step" :class="{ 'active': currentStep >= 2 }">
                                <div class="step-icon">
                                    <i class="el-icon-connection"></i>
                                </div>
                                <div class="step-text">生成流程</div>
                            </div>
                            <div class="process-step" :class="{ 'active': currentStep >= 3 }">
                                <div class="step-icon">
                                    <i class="el-icon-lock"></i>
                                </div>
                                <div class="step-text">配置权限</div>
                            </div>
                            <div class="process-step" :class="{ 'active': currentStep >= 4 }">
                                <div class="step-icon">
                                    <i class="el-icon-success"></i>
                                </div>
                                <div class="step-text">生成完成</div>
                            </div>
                        </div>

                        <div class="ai-content" :class="{ 'no-margin': !showProcess }">
                            <div v-for="(message, index) in aiMessages" 
                                 :key="index" 
                                 class="ai-message"
                                 :class="{ 'user': message.isUser }">
                                {{ message.content }}
                            </div>
                        </div>
                        <div class="ai-input">
                            <el-input v-model="aiInput" 
                                     placeholder="请描述您想要的页面布局和功能"
                                     @keyup.enter="generatePage">
                            </el-input>
                            <el-button type="primary" @click="generatePage">生成</el-button>
                        </div>
                    </div>
                </el-dialog>

                <!-- AI 流程生成对话框 -->
                <el-dialog
                    title="AI 流程生成器"
                    :visible.sync="showWorkflowAiDialog"
                    custom-class="workflow-dialog"
                    :close-on-click-modal="false"
                    :close-on-press-escape="false"
                    :show-close="!isGeneratingWorkflow"
                    @open="handleWorkflowDialogOpen">
                    <div class="ai-container">
                        <div class="generation-process" :class="{ 'show': showWorkflowProcess }">
                            <div class="process-step" :class="{ 'active': currentWorkflowStep >= 1 }">
                                <div class="step-icon">
                                    <i class="el-icon-share"></i>
                                </div>
                                <div class="step-text">分析需求</div>
                            </div>
                            <div class="process-step" :class="{ 'active': currentWorkflowStep >= 2 }">
                                <div class="step-icon">
                                    <i class="el-icon-connection"></i>
                                </div>
                                <div class="step-text">生成节点</div>
                            </div>
                            <div class="process-step" :class="{ 'active': currentWorkflowStep >= 3 }">
                                <div class="step-icon">
                                    <i class="el-icon-user"></i>
                                </div>
                                <div class="step-text">配置角色</div>
                            </div>
                            <div class="process-step" :class="{ 'active': currentWorkflowStep >= 4 }">
                                <div class="step-icon">
                                    <i class="el-icon-success"></i>
                                </div>
                                <div class="step-text">生成完成</div>
                            </div>
                        </div>

                        <div class="ai-content" :class="{ 'no-margin': !showWorkflowProcess }">
                            <div v-for="(message, index) in workflowAiMessages" 
                                 :key="index" 
                                 class="ai-message"
                                 :class="{ 'user': message.isUser }">
                                {{ message.content }}
                            </div>
                        </div>
                        <div class="ai-input">
                            <el-input v-model="workflowAiInput" 
                                     placeholder="请描述您想要的业务流程"
                                     @keyup.enter="generateWorkflow">
                            </el-input>
                            <el-button type="primary" @click="generateWorkflow">生成</el-button>
                        </div>
                    </div>
                </el-dialog>

                <!-- AI 数据流程生成对话框 -->
                <el-dialog
                    title="AI 数据流程生成器"
                    :visible.sync="showDataflowAiDialog"
                    custom-class="workflow-dialog"
                    :close-on-click-modal="false"
                    :close-on-press-escape="false"
                    :show-close="!isGeneratingDataflow"
                    @open="handleDataflowDialogOpen">
                    <div class="ai-container">
                        <div class="generation-process" :class="{ 'show': showDataflowProcess }">
                            <div class="process-step" :class="{ 'active': currentDataflowStep >= 1 }">
                                <div class="step-icon">
                                    <i class="el-icon-share"></i>
                                </div>
                                <div class="step-text">分析需求</div>
                            </div>
                            <div class="process-step" :class="{ 'active': currentDataflowStep >= 2 }">
                                <div class="step-icon">
                                    <i class="el-icon-connection"></i>
                                </div>
                                <div class="step-text">生成节点</div>
                            </div>
                            <div class="process-step" :class="{ 'active': currentDataflowStep >= 3 }">
                                <div class="step-icon">
                                    <i class="el-icon-refresh"></i>
                                </div>
                                <div class="step-text">配置数据源</div>
                            </div>
                            <div class="process-step" :class="{ 'active': currentDataflowStep >= 4 }">
                                <div class="step-icon">
                                    <i class="el-icon-success"></i>
                                </div>
                                <div class="step-text">生成完成</div>
                            </div>
                        </div>

                        <div class="ai-content" :class="{ 'no-margin': !showDataflowProcess }">
                            <div v-for="(message, index) in dataflowAiMessages" 
                                 :key="index" 
                                 class="ai-message"
                                 :class="{ 'user': message.isUser }">
                                {{ message.content }}
                            </div>
                        </div>
                        <div class="ai-input">
                            <el-input v-model="dataflowAiInput" 
                                     placeholder="请描述您想要的数据流程"
                                     @keyup.enter="generateDataflow">
                            </el-input>
                            <el-button type="primary" @click="generateDataflow">生成</el-button>
                        </div>
                    </div>
                </el-dialog>
            </el-main>
        </el-container>
    </div>

    <!-- 引入Vue和Element UI -->
    <script src="https://unpkg.com/vue@2.6.14/dist/vue.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script>
        new Vue({
            el: '#app',
            data() {
                return {
                    aiInput: '',
                    aiMessages: [],
                    workflowAiInput: '',
                    workflowAiMessages: [],
                    dataflowAiInput: '',
                    dataflowAiMessages: [],
                    currentStep: 0,
                    currentWorkflowStep: 0,
                    currentDataflowStep: 0,
                    showProcess: false,
                    showWorkflowProcess: false,
                    showDataflowProcess: false,
                    showResult: false,
                    showWorkflowResult: false,
                    showDataflowResult: false,
                    isGenerating: false,
                    isGeneratingWorkflow: false,
                    isGeneratingDataflow: false,
                    activeTab: 'pages',
                    showAiDialog: false,
                    showWorkflowAiDialog: false,
                    showWorkflowDialog: false,
                    showDataflowAiDialog: false,
                    pageConfig: {
                        pages: {
                            currentPage: 1,
                            pageSize: 10,
                            total: 0
                        },
                        workflows: {
                            currentPage: 1,
                            pageSize: 10,
                            total: 0
                        },
                        dataflows: {
                            currentPage: 1,
                            pageSize: 10,
                            total: 0
                        }
                    },
                    dataflowList: [
                        {
                            name: '客户数据同步流程',
                            type: '同步流程',
                            source: 'CRM系统',
                            createTime: '2024-03-20 10:30:00',
                            status: '运行中',
                            icon: 'el-icon-refresh',
                            level: 1,
                            children: [
                                {
                                    name: '基础信息同步',
                                    type: '同步流程',
                                    source: 'CRM系统',
                                    createTime: '2024-03-20 10:35:00',
                                    status: '运行中',
                                    icon: 'el-icon-data-line',
                                    level: 2
                                },
                                {
                                    name: '交易记录同步',
                                    type: '同步流程',
                                    source: 'CRM系统',
                                    createTime: '2024-03-20 10:40:00',
                                    status: '运行中',
                                    icon: 'el-icon-money',
                                    level: 2
                                }
                            ]
                        },
                        {
                            name: '订单数据处理流程',
                            type: '处理流程',
                            source: '订单系统',
                            createTime: '2024-03-19 15:45:00',
                            status: '已停止',
                            icon: 'el-icon-shopping-cart-full',
                            level: 1,
                            children: [
                                {
                                    name: '订单清洗',
                                    type: '处理流程',
                                    source: '订单系统',
                                    createTime: '2024-03-19 15:50:00',
                                    status: '已停止',
                                    icon: 'el-icon-magic-stick',
                                    level: 2
                                }
                            ]
                        }
                    ],
                    newWorkflow: {
                        name: '',
                        type: '工作流程',
                        department: ''
                    },
                    pageList: [
                        {
                            name: '智能库存管理系统',
                            type: '管理页面',
                            createTime: '2024-03-20 10:30:00',
                            status: '已发布',
                            level: 1,
                            children: [
                                {
                                    name: '库存列表',
                                    type: '列表页面',
                                    createTime: '2024-03-20 10:35:00',
                                    status: '已发布',
                                    level: 2
                                },
                                {
                                    name: '库存详情',
                                    type: '详情页面',
                                    createTime: '2024-03-20 10:40:00',
                                    status: '已发布',
                                    level: 2
                                }
                            ]
                        },
                        {
                            name: '数据分析大屏',
                            type: '可视化页面',
                            createTime: '2024-03-19 15:45:00',
                            status: '未发布',
                            level: 1,
                            children: [
                                {
                                    name: '销售分析',
                                    type: '图表页面',
                                    createTime: '2024-03-19 15:50:00',
                                    status: '未发布',
                                    level: 2
                                }
                            ]
                        },
                        {
                            name: '用户管理系统',
                            type: '管理页面',
                            createTime: '2024-03-18 09:20:00',
                            status: '已发布',
                            level: 1,
                            children: [
                                {
                                    name: '用户列表',
                                    type: '列表页面',
                                    createTime: '2024-03-18 09:25:00',
                                    status: '已发布',
                                    level: 2
                                },
                                {
                                    name: '用户详情',
                                    type: '详情页面',
                                    createTime: '2024-03-18 09:30:00',
                                    status: '已发布',
                                    level: 2
                                }
                            ]
                        }
                    ],
                    workflowList: [
                        {
                            name: '采购申请流程',
                            type: '审批流程',
                            department: '采购部',
                            createTime: '2024-03-20 10:30:00',
                            status: '已启用',
                            icon: 'el-icon-shopping-cart-full',
                            level: 1,
                            children: [
                                {
                                    name: '常规采购审批',
                                    type: '审批流程',
                                    department: '采购部',
                                    createTime: '2024-03-20 10:35:00',
                                    status: '已启用',
                                    icon: 'el-icon-document-checked',
                                    level: 2
                                },
                                {
                                    name: '紧急采购审批',
                                    type: '审批流程',
                                    department: '采购部',
                                    createTime: '2024-03-20 10:40:00',
                                    status: '已启用',
                                    icon: 'el-icon-warning',
                                    level: 2
                                }
                            ]
                        },
                        {
                            name: '人事管理流程',
                            type: '工作流程',
                            department: '人力资源部',
                            createTime: '2024-03-19 15:45:00',
                            status: '已启用',
                            icon: 'el-icon-user',
                            level: 1,
                            children: [
                                {
                                    name: '员工入职流程',
                                    type: '工作流程',
                                    department: '人力资源部',
                                    createTime: '2024-03-19 15:50:00',
                                    status: '已启用',
                                    icon: 'el-icon-plus',
                                    level: 2
                                },
                                {
                                    name: '员工离职流程',
                                    type: '工作流程',
                                    department: '人力资源部',
                                    createTime: '2024-03-19 15:55:00',
                                    status: '已启用',
                                    icon: 'el-icon-minus',
                                    level: 2
                                }
                            ]
                        },
                        {
                            name: '财务审批流程',
                            type: '审批流程',
                            department: '财务部',
                            createTime: '2024-03-18 09:20:00',
                            status: '已启用',
                            icon: 'el-icon-money',
                            level: 1,
                            children: [
                                {
                                    name: '报销审批',
                                    type: '审批流程',
                                    department: '财务部',
                                    createTime: '2024-03-18 09:25:00',
                                    status: '已启用',
                                    icon: 'el-icon-document',
                                    level: 2
                                },
                                {
                                    name: '预算审批',
                                    type: '审批流程',
                                    department: '财务部',
                                    createTime: '2024-03-18 09:30:00',
                                    status: '未启用',
                                    icon: 'el-icon-wallet',
                                    level: 2
                                }
                            ]
                        }
                    ]
                }
            },
            methods: {
                goBack() {
                    window.location.href = 'index.html';
                },
                goToEditor() {
                    window.location.href = 'layout-editor.html';
                },
                handlePreview(row) {
                    const params = new URLSearchParams({
                        name: row.name,
                        type: row.type
                    });
                    window.location.href = `preview-page.html?${params.toString()}`;
                },
                closeModal() {
                    this.showResult = false;
                },
                handleDialogOpen() {
                    // 重置所有状态
                    this.isGenerating = false;
                    this.showProcess = false;
                    this.showResult = false;
                    this.aiMessages = [];
                    this.aiInput = '';
                    this.currentStep = 0;
                    
                    // 添加欢迎消息
                    setTimeout(() => {
                        this.aiMessages = [{
                            content: '欢迎使用 AI 页面生成器，请描述您想要的页面布局和功能，我会帮您生成对应的页面。',
                            isUser: false
                        }];
                    }, 300);
                },
                startGenerate() {
                    this.showAiDialog = true;
                },
                handlePublish(row) {
                    if (row.status === '已发布') {
                        this.$confirm('确认下线该页面吗？', '提示', {
                            confirmButtonText: '确定',
                            cancelButtonText: '取消',
                            type: 'warning'
                        }).then(() => {
                            row.status = '未发布';
                            this.$message.success('下线成功');
                        }).catch(() => {});
                    } else {
                        this.$confirm('确认发布该页面吗？', '提示', {
                            confirmButtonText: '确定',
                            cancelButtonText: '取消',
                            type: 'warning'
                        }).then(() => {
                            row.status = '已发布';
                            this.$message.success('发布成功');
                        }).catch(() => {});
                    }
                },
                generatePage() {
                    this.isGenerating = true;
                    const message = this.aiInput.trim();
                    if (message) {
                        // 截取前30个字符作为页面名称
                        const pageName = message.length > 30 ? message.substring(0, 30) + '...' : message;
                        
                        this.aiMessages.push({
                            content: message,
                            isUser: true
                        });
                        this.aiInput = '';
                        
                        // 先添加AI响应消息
                        this.aiMessages.push({
                            content: '正在分析您的需求...',
                            isUser: false
                        });
                        
                        // 延迟显示进度条，产生渐入效果
                        setTimeout(() => {
                            this.showProcess = true;
                            
                            // 开始生成流程
                            this.currentStep = 1;
                            
                            // 模拟生成流程
                            const steps = [
                                '正在生成页面布局...',
                                '正在生成业务流程...',
                                '正在配置权限规则...',
                                '页面生成完成！'
                            ];
                            
                            steps.forEach((step, index) => {
                                setTimeout(() => {
                                    this.currentStep = index + 1;
                                    this.aiMessages.push({
                                        content: step,
                                        isUser: false
                                    });
                                    
                                    // 在最后一步完成后显示结果
                                    if (index === steps.length - 1) {
                                        setTimeout(() => {
                                            this.showProcess = false;
                                            this.isGenerating = false;
                                            
                                            // 创建新的页面
                                            const page = {
                                                name: pageName,
                                                type: '管理页面',
                                                createTime: new Date().toLocaleString(),
                                                status: '未发布',
                                                level: 1
                                            };
                                            
                                            this.pageList.unshift(page);
                                            this.showAiDialog = false;
                                            this.$message.success('页面生成成功！');
                                        }, 500);
                                    }
                                }, (index + 1) * 1500);
                            });
                        }, 500);
                    }
                },
                handlePreviewWorkflow(row) {
                    this.$message('预览流程图：' + row.name);
                    // 这里可以添加预览流程图的逻辑
                },
                
                editWorkflow(row) {
                    const params = new URLSearchParams({
                        name: row.name,
                        type: row.type,
                        department: row.department,
                        status: row.status,
                        icon: row.icon
                    });
                    window.location.href = `workflow-editor.html?${params.toString()}`;
                },
                
                handleWorkflowStatus(row) {
                    const action = row.status === '已启用' ? '停用' : '启用';
                    this.$confirm(`确认${action}该流程吗？`, '提示', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(() => {
                        row.status = row.status === '已启用' ? '未启用' : '已启用';
                        this.$message.success(`${action}成功`);
                    }).catch(() => {});
                },
                createWorkflow() {
                    if (!this.newWorkflow.name || !this.newWorkflow.department) {
                        this.$message.warning('请填写完整信息');
                        return;
                    }

                    const workflow = {
                        ...this.newWorkflow,
                        createTime: new Date().toLocaleString(),
                        status: '未启用',
                        icon: this.newWorkflow.type === '审批流程' ? 'el-icon-document-checked' : 'el-icon-set-up',
                        level: 1,
                        children: []
                    };

                    this.workflowList.unshift(workflow);
                    this.showWorkflowDialog = false;
                    this.$message.success('创建成功');

                    // 重置表单
                    this.newWorkflow = {
                        name: '',
                        type: '工作流程',
                        department: ''
                    };
                },
                handleWorkflowDialogOpen() {
                    // 重置所有状态
                    this.isGeneratingWorkflow = false;
                    this.showWorkflowProcess = false;
                    this.showWorkflowResult = false;
                    this.workflowAiMessages = [];
                    this.workflowAiInput = '';
                    this.currentWorkflowStep = 0;
                    
                    // 添加欢迎消息
                    setTimeout(() => {
                        this.workflowAiMessages = [{
                            content: '欢迎使用 AI 流程生成器，请描述您想要的业务流程，我会帮您生成对应的工作流。',
                            isUser: false
                        }];
                    }, 300);
                },
                generateWorkflow() {
                    this.isGeneratingWorkflow = true;
                    const message = this.workflowAiInput.trim();
                    if (message) {
                        // 截取前30个字符作为流程名称
                        const workflowName = message.length > 30 ? message.substring(0, 30) + '...' : message;
                        
                        this.workflowAiMessages.push({
                            content: message,
                            isUser: true
                        });
                        this.workflowAiInput = '';
                        
                        // 先添加AI响应消息
                        this.workflowAiMessages.push({
                            content: '正在分析您的流程需求...',
                            isUser: false
                        });
                        
                        // 延迟显示进度条，产生渐入效果
                        setTimeout(() => {
                            this.showWorkflowProcess = true;
                            this.showWorkflowResult = false;
                            
                            // 开始生成流程
                            this.currentWorkflowStep = 1;
                            
                            // 模拟生成流程
                            const steps = [
                                '正在分析业务场景...',
                                '正在生成流程节点...',
                                '正在配置审批角色...',
                                '流程生成完成！'
                            ];
                            
                            steps.forEach((step, index) => {
                                setTimeout(() => {
                                    this.currentWorkflowStep = index + 1;
                                    this.workflowAiMessages.push({
                                        content: step,
                                        isUser: false
                                    });
                                    
                                    // 在最后一步完成后显示结果
                                    if (index === steps.length - 1) {
                                        setTimeout(() => {
                                            this.showWorkflowProcess = false;
                                            setTimeout(() => {
                                                // 创建新的流程
                                                const workflow = {
                                                    name: workflowName,  // 使用用户输入的名称
                                                    type: message.includes('审批') ? '审批流程' : '工作流程',  // 根据输入内容智能判断流程类型
                                                    department: '系统管理部',
                                                    createTime: new Date().toLocaleString(),
                                                    status: '未启用',
                                                    icon: message.includes('审批') ? 'el-icon-document-checked' : 'el-icon-set-up',  // 根据类型设置图标
                                                    level: 1,
                                                    children: []
                                                };
                                                
                                                this.workflowList.unshift(workflow);
                                                this.showWorkflowAiDialog = false;
                                                this.$message.success('流程生成成功！');
                                            }, 300);
                                        }, 500);
                                    }
                                }, (index + 1) * 1500);
                            });
                        }, 500);
                    }
                },
                handlePreviewDataflow(row) {
                    this.$message('预览数据流程：' + row.name);
                },
                
                editDataflow(row) {
                    const params = new URLSearchParams({
                        name: row.name,
                        type: row.type,
                        source: row.source,
                        status: row.status,
                        icon: row.icon
                    });
                    window.location.href = `dataflow-editor.html?${params.toString()}`;
                },
                
                handleDataflowStatus(row) {
                    const action = row.status === '运行中' ? '停止' : '启动';
                    this.$confirm(`确认${action}该数据流程吗？`, '提示', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(() => {
                        row.status = row.status === '运行中' ? '已停止' : '运行中';
                        this.$message.success(`${action}成功`);
                    }).catch(() => {});
                },
                handleDataflowDialogOpen() {
                    // 重置所有状态
                    this.isGeneratingDataflow = false;
                    this.showDataflowProcess = false;
                    this.showDataflowResult = false;
                    this.dataflowAiMessages = [];
                    this.dataflowAiInput = '';
                    this.currentDataflowStep = 0;
                    
                    // 添加欢迎消息
                    setTimeout(() => {
                        this.dataflowAiMessages = [{
                            content: '欢迎使用 AI 数据流程生成器，请描述您想要的数据流程，我会帮您生成对应的流程。',
                            isUser: false
                        }];
                    }, 300);
                },
                generateDataflow() {
                    this.isGeneratingDataflow = true;
                    const message = this.dataflowAiInput.trim();
                    if (message) {
                        this.dataflowAiMessages.push({
                            content: message,
                            isUser: true
                        });
                        this.dataflowAiInput = '';
                        
                        // 先添加AI响应消息
                        this.dataflowAiMessages.push({
                            content: '正在分析您的数据流程需求...',
                            isUser: false
                        });
                        
                        // 延迟显示进度条，产生渐入效果
                        setTimeout(() => {
                            this.showDataflowProcess = true;
                            
                            // 开始生成流程
                            this.currentDataflowStep = 1;
                            
                            // 模拟生成流程
                            const steps = [
                                '正在分析数据结构...',
                                '正在生成流程节点...',
                                '正在配置数据源...',
                                '流程生成完成！'
                            ];
                            
                            steps.forEach((step, index) => {
                                setTimeout(() => {
                                    this.currentDataflowStep = index + 1;
                                    this.dataflowAiMessages.push({
                                        content: step,
                                        isUser: false
                                    });
                                    
                                    // 在最后一步完成后显示结果
                                    if (index === steps.length - 1) {
                                        setTimeout(() => {
                                            this.showDataflowProcess = false;
                                            setTimeout(() => {
                                                // 创建新的数据流程
                                                const dataflow = {
                                                    name: message.length > 30 ? message.substring(0, 30) + '...' : message,
                                                    type: message.includes('同步') ? '同步流程' : '处理流程',
                                                    source: '数据中心',
                                                    createTime: new Date().toLocaleString(),
                                                    status: '已停止',
                                                    icon: message.includes('同步') ? 'el-icon-refresh' : 'el-icon-data-line',
                                                    level: 1,
                                                    children: []
                                                };
                                                
                                                this.dataflowList.unshift(dataflow);
                                                this.showDataflowAiDialog = false;
                                                this.$message.success('数据流程生成成功！');
                                            }, 300);
                                        }, 500);
                                    }
                                }, (index + 1) * 1500);
                            });
                        }, 500);
                    }
                },
                handlePageSizeChange(val) {
                    this.pageConfig.pages.pageSize = val;
                    this.updatePageList();
                },
                handlePageChange(val) {
                    this.pageConfig.pages.currentPage = val;
                    this.updatePageList();
                },
                handleWorkflowPageSizeChange(val) {
                    this.pageConfig.workflows.pageSize = val;
                    this.updateWorkflowList();
                },
                handleWorkflowPageChange(val) {
                    this.pageConfig.workflows.currentPage = val;
                    this.updateWorkflowList();
                },
                handleDataflowPageSizeChange(val) {
                    this.pageConfig.dataflows.pageSize = val;
                    this.updateDataflowList();
                },
                handleDataflowPageChange(val) {
                    this.pageConfig.dataflows.currentPage = val;
                    this.updateDataflowList();
                },
                updatePageList() {
                    // Update total count
                    this.pageConfig.pages.total = this.pageList.length;
                },
                updateWorkflowList() {
                    // Update total count
                    this.pageConfig.workflows.total = this.workflowList.length;
                },
                updateDataflowList() {
                    // Update total count
                    this.pageConfig.dataflows.total = this.dataflowList.length;
                },
                created() {
                    // 从URL参数获取流程数据
                    const params = new URLSearchParams(window.location.search);
                    const dataflowData = {
                        name: params.get('name') || '未命名流程',
                        type: params.get('type') || '同步流程',
                        source: params.get('source') || '数据中心',
                        status: params.get('status') || '已停止',
                        icon: params.get('icon') || 'el-icon-data-line'
                    };
                    this.dataflowData = dataflowData;
                    
                    // 初始化示例节点
                    this.nodes = [
                        // ... existing nodes ...
                    ];

                    // 初始化分页数据
                    this.updatePageList();
                    this.updateWorkflowList();
                    this.updateDataflowList();
                }
            }
        })
    </script>
</body>
</html> 